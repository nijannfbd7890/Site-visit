<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Staff Wise Range Achieved (%) Report</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
body{font-family:Poppins;background:#f4f6f9;margin:0}
.header{background:#1f3c88;color:#fff;padding:25px;text-align:center}
.subheader{background:#1f3c88;color:#fff;text-align:center;padding-bottom:15px}
.container{padding:20px}
.filters{display:flex;justify-content:center;gap:10px;margin:20px}
.filters input,.filters button{padding:8px 12px;border-radius:6px;border:1px solid #ccc}
.filters button{background:#1f3c88;color:#fff;cursor:pointer}
.summary{display:flex;gap:20px;justify-content:center;margin-bottom:20px}
.box{background:#fff;padding:10px 20px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
thead th{background:#f4b400;color:#000}
tbody tr:nth-child(even){background:#e3f2fd}
tbody tr:nth-child(odd){background:#fff8e1}
tfoot tr{background:#fdd835;font-weight:bold}

nav {
  display: flex;
  justify-content: center;
  gap: 15px;
  background: #eaf0ff;
  padding: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
nav a {
  color: #1e3a8a;
  text-decoration: none;
  font-weight: 600;
  background: #ffffff;
  padding: 8px 18px;
  border-radius: 8px;
  transition: 0.3s ease;
  border: 1px solid #c5cae9;
}
nav a:hover,
nav a.active {
  background: #1e3a8a;
  color: #fff;
  transform: scale(1.03);
}
</style>
</head>

<body>

<div class="header">
  <h1>Staff Wise Range Achieved (%) Report</h1>
  <h3>Namma Family Builder and Developer Pvt. Ltd</h3>
  <p>Team - Marketing Management</p>
</div>
<nav>
  <a href="index.html">üè† Dashboard</a>
  <a href="Teamwise Range.html">üìä Teamwise Range</a>
  <a href="Staffwise-range.html" class="active">üíº Staffwise Range</a>
</nav>

<div class="container">

<div class="filters">
  <input type="date" id="fromDate">
  <input type="date" id="toDate">
  <button onclick="applyFilter()">Apply Filter</button>
</div>

<div class="summary">
  <div class="box">Total Site Visits: <b id="svTotal">0</b></div>
  <div class="box">Below 8: <b id="svBelow">0</b></div>
  <div class="box">Above 8: <b id="svAbove">0</b></div>
  <div class="box">Booking Count: <b id="bkCount">0</b></div>
  <div class="box">Total Sqft: <b id="bkSqft">0</b></div>
</div>

<table id="reportTable">
<thead>
<tr>
  <th rowspan="2">S.No</th>
  <th rowspan="2">Staff Name</th>
  <th colspan="3">Site Visit</th>
  <th rowspan="2">Target Sq.ft</th>
  <th colspan="3">Overall Booking</th>
</tr>
<tr>
  <th>Below 8</th>
  <th>Above 8</th>
  <th>Total</th>
  <th>Count</th>
  <th>Sqft</th>
  <th>%</th>
</tr>
</thead>
<tbody></tbody>
<tfoot></tfoot>
</table>
<script>

const CSV_BOOKING = "https://nijannfbd7890.github.io/Site-visit/workbook.csv";
const CSV_VISIT   = "https://nijannfbd7890.github.io/Site-visit/SITE_VISIT.csv";


// STEP 1: Staff master list (as provided)
const staffMaster = [
  { name: "Mr.N.Sakthivel Sir", target: 1400 },
  { name: "Mr.E.Praveen sir", target: 2200 },
  { name: "Mr.K.Gowtham Sir", target: 2200 },
  { name: "Mr.S.Selvaraj sir", target: 2200 },
  { name: "Mrs.B.Preethi madam", target: 2000 },
  { name: "Mr.S.Srikanth Sir", target: 1700 },
  { name: "Mrs.R.Gowthamarani Madam", target: 1400 },
  { name: "Mr.E.Ilayaraja Sir", target: 1700 },
  { name: "Mrs.S.Sneka Madam", target: 2000 },
  { name: "Mr.A.Arun sir", target: 2200 },
  { name: "Mr.A.Sugunesh sir", target: 2200 },
  { name: "Mr.N.Parthiban Sir", target: 1400 },
  { name: "Mrs.Gomathi madam", target: 2000 },
  { name: "Mr.S.Govindan Sir", target: 2200 },
  { name: "Mrs.J.Pavithra madam", target: 1400 },
  { name: "Mr.S.Karthikeyan sir", target: 2200 },
  { name: "Mr.K.Thamizharasan Sir", target: 1700 },
  { name: "Mr.M.Siva Sir", target: 1700 },
  { name: "Ms.S.Sandhiya Madam", target: 2000 },
  { name: "Mr.M.Thirunavukkarasu Sir", target: 2200 },
  { name: "Mr.C.Vijayan sir", target: 2200 },
  { name: "Mr.J.Ajith Kumar sir", target: 2200 },
  { name: "Mr.R.Vignesh sir", target: 1200 },
  { name: "Mr.E.Siva sir", target: 1700 },
  { name: "Mr.A.Kannadhasan sir", target: 2200 },
  { name: "Mr.A.Rajkumar sir", target: 2200 },
  { name: "Mrs.Sathiya Madam", target: 1400 },
  { name: "Mrs.T.Prabhavathi madam", target: 2000 },
  { name: "Mrs.D.Srividhiya Madam", target: 2000 },
  { name: "Mr.P.Suresh Sir", target: 1200 },
  { name: "Mr.A.Praveen kumar sir", target: 2200 },
  { name: "Ms.P.Ramya Madam", target: 1400 },
  { name: "Mr.A.Rajadurai sir", target: 2200 },
  { name: "Mr.A.Sakthimurugan Sir", target: 1400 },
  { name: "Mr.P.B.Anthony Raj sir", target: 1400 },
  { name: "Mrs.B.Jayalakshmi madam", target: 2000 },
  { name: "Mr.E.Mugil Vanan sir", target: 1400 },
  { name: "Mr.M.Balamuthu Sir", target: 1700 },
  { name: "Mr.M.Jayasuriya sir", target: 2200 },
  { name: "Mr.M.Chinnadurai Sir", target: 1400 },
  { name: "Mr.A.Arockiya Prabakaran Sir", target: 1400 },
  { name: "Mr.M.Ezhumalai Sir", target: 1700 },
  { name: "Mr.A.Manikandan Sir", target: 2200 },
  { name: "Mr.A.G.Vinayagam Sir", target: 1700 },
  { name: "Mr.A.Ayyappan Sir", target: 1700 },
  { name: "Mr.L.Sathish Sir", target: 1700 },
  { name: "Mr.R.Jeeva sir", target: 1700 },
  { name: "Mr.K.Ayyappan sir", target: 1700 },
  { name: "Mr.B.Prakash Sir", target: 1700 },
  { name: "Mr.P.Govinthan Sir", target: 1200 },
  { name: "Mr.P.Vignesh Sir", target: 1200 },
  { name: "Mr.A.Madhavan Sir", target: 1200 },
  { name: "Mr.S.Jayamani Sir", target: 1200 },
  { name: "Mr.A.Iyyappaan Sir", target: 1200 },
  { name: "Mr.B.Ajith Kumar Sir", target: 1200 },
  { name: "Mr.K.Tharun Sir", target: 1200 },
  { name: "Mr.P.Dineshkumar sir", target: 1200 },
  { name: "Mr.G.Manikandan sir", target: 1200 },
  { name: "Mr.M.Selvam Sir", target: 1200 },
  { name: "Ms.S.Meera sri madam", target: 2000 },
  { name: "Ms.C.Keerthana Madam", target: 1400 },
  { name: "Ms.Thirushna madam", target: 1400 },
  { name: "Ms.P.Bhavani Madam", target: 1400 },
  { name: "Ms.P.Parameshwari mam", target: 1400 },
  { name: "Ms.M.Kayalvizhi", target: 1400 },
  { name: "Mrs.Keerthana Mam", target: 1400 },
  { name: "Ms.M.Jayasri Madam", target: 1400 },
  { name: "Mr.P.Ramesh sir", target: 2200 },
  { name: "Mr.S.Manikandan sir", target: 2200 },
  { name: "Mr.P.Santhana Krishnan sir", target: 2200 },
  { name: "Mr.K.Prakash sir", target: 2200 },
  { name: "Mr.R.Shawn michael sir", target: 2200 },
  { name: "Mr.J.Ayyappan sir", target: 2200 },
  { name: "Mr.G.Muthupandi Raja sir", target: 2200 },
  { name: "Mr.R.Sathish Kumar Sir", target: 1400 },
  { name: "Mr.S.Janarthanam Sir", target: 2200 },
  { name: "Mr.P.Lakshmanan Sir", target: 1400 },
  { name: "Mr.J.Clement Antony Raj Sir", target: 1400 },
  { name: "Mr.J.Thamizharasan sir", target: 1400 },
  { name: "Mr.A.Prabhu sir", target: 1400 },
  { name: "Mr.S.Karthi Sir", target: 1400 },
  { name: "Mr.G.Nandhakumar sir", target: 1400 }
];


function normalizeName(name) {
  return name
    .toLowerCase()
    .replace(/\./g, "")
    .replace(/\b(mr|mrs|ms|sir|madam|mam)\b/g, "")
    .replace(/\s+/g, "")
    .trim();
}



// Render staff table (STEP 1)

function renderStaffMaster() {
  const tbody = document.querySelector("#reportTable tbody");
  const tfoot = document.querySelector("#reportTable tfoot");

  tbody.innerHTML = "";
  tfoot.innerHTML = "";

  let totalTarget = 0;

  staffMaster.forEach((staff, index) => {
    totalTarget += staff.target;

    tbody.innerHTML += `
      <tr>
        <td>${index + 1}</td>
        <td>${staff.name}</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>${staff.target}</td>
        <td>0</td>
        <td>0</td>
        <td>0%</td>
      </tr>
    `;
  });

  // ‚úÖ GRAND TOTAL ROW
  tfoot.innerHTML = `
    <tr>
      <td colspan="5">Grand Total</td>
      <td>${totalTarget}</td>
      <td>0</td>
      <td>0</td>
      <td>0%</td>
    </tr>
  `;
}



function loadSiteVisits() {

  Papa.parse("CSV_VISIT.csv", {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function (result) {

      const visitData = result.data;
      const tbodyRows = document.querySelectorAll("#reportTable tbody tr");

      let totalBelow = 0;
      let totalAbove = 0;

      tbodyRows.forEach(row => {

        const staffName = row.children[1].innerText;
        const staffKey = normalizeName(staffName);

        let below = 0;
        let above = 0;

        visitData.forEach(v => {
          const visitStaff = v["TELE MARKETING STAFF NAME"];
          const visitRange = Number(v["RANGE"]);

          if (!visitStaff || isNaN(visitRange)) return;

          if (normalizeName(visitStaff) === staffKey) {
            if (visitRange < 8) below++;
            else above++;
          }
        });
		console.log("CSV HEADERS:", Object.keys(result.data[0]));

        row.children[2].innerText = below;
        row.children[3].innerText = above;
        row.children[4].innerText = below + above;

        totalBelow += below;
        totalAbove += above;
      });

      // Summary update
      document.getElementById("svBelow").innerText = totalBelow;
      document.getElementById("svAbove").innerText = totalAbove;
      document.getElementById("svTotal").innerText = totalBelow + totalAbove;
    }
  });
}



// Auto load on page open
window.onload = function () {
  renderStaffMaster();
  loadSiteVisits();
};

</script>
</body>
</html>